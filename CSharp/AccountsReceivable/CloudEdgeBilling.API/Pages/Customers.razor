@page "/customers"
@inherits EditableDataGridPage<Customer>

@{
    base.BuildRenderTree(__builder);
}

<MudDataGrid
    @ref="DataGrid" T="Customer" ServerData="@(new Func<GridState<Customer>, Task<GridData<Customer>>>(GridServerReload))"
    SortMode="SortMode.Multiple" Filterable="true" FilterMode="DataGridFilterMode.ColumnFilterMenu"
    RowClick="@RowClicked" RowStyleFunc="@RowStyleFunc" SelectOnRowClick="false"
    ReadOnly="@ReadOnly" EditMode="DataGridEditMode.Cell"
    CommittedItemChanges="@CommittedRowChanges"
    MultiSelection="true" SelectedItemsChanged="@SelectedRowsChanged"
    Hover="true" Striped="true" Bordered="true" Height="calc(100vh - 13.2rem)" ColumnResizeMode="ResizeMode.Column">
    <Columns>
        @if (Removable)
        {
            <SelectColumn T="Customer" ShowInFooter="false"/>
        }
        <PropertyColumn Property="@(x => x.CustomerName)" Title="Customer Name" Required="false"/>
        <PropertyColumn Property="@(x => x.DomainName)" Title="Domain Name" Required="false" IsEditable="false"/>
        <PropertyColumn Property="@(x => x.XeroContactName)" Title="Xero Contact Name" Required="false" IsEditable="false"/>
        <PropertyColumn Property="@(x => x.PayMonthlyPlan)" Title="Plan Name" Required="false">
            <EditTemplate>
                <MudSelect T="@(PayMonthlyPlan?)" @bind-Value="@(context.Item.PayMonthlyPlan)"
                           Clearable="true" Dense="true">
                    @foreach (var plan in _payMonthlyPlans)
                    {
                        <MudSelectItem Value="@plan">@plan.PlanName</MudSelectItem>
                    }
                </MudSelect>
            </EditTemplate>
        </PropertyColumn>
        @if (ShowIsActive)
        {
            <PropertyColumn Property="@(x => x.IsActive)" Title="Is Active" Required="false">
                <EditTemplate>
                    <MudSwitch @bind-Checked="@context.Item.IsActive" Color="Color.Primary" Size="Size.Small">
                        @(context.Item.IsActive ? "True" : "False")
                    </MudSwitch>
                </EditTemplate>
            </PropertyColumn>
        }
        <PropertyColumn Property="@(x => x.Location)" Title="Location" Required="false"/>
    </Columns>
    <NoRecordsContent>
        <MudText>No matching Customers found</MudText>
    </NoRecordsContent>
    <LoadingContent>
        <MudText>Loading Customers...</MudText>
    </LoadingContent>
    <PagerContent>
        <MudDataGridPager T="Customer" PageSizeOptions="new[] { 25, 50, 100 }"/>
    </PagerContent>
</MudDataGrid>