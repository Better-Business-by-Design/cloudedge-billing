@page "/ats"

<Breadcrumb Items="_breadcrumb" />

<MudTable Dense="true" Hover="true" Outlined="true"
          ServerData="@(new Func<TableState, Task<TableData<Document>>>(ServerReload))"
          @ref="_table"
          T="Document">
    <ToolBarContent>
        <MudText Typo="Typo.h5">Animals in Transit</MudText>
        <MudSpacer/>
        <MudTextField T="string" ValueChanged="OnSearch" Placeholder="Search" Adornment="Adornment.Start"
                      AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Class="mt-0">
        </MudTextField>
    </ToolBarContent>
    <HeaderContent>
        <MudTh>
            <MudTableSortLabel SortLabel="date_field" T="Document">
                Date
            </MudTableSortLabel>
        </MudTh>
        <MudTh>
            <MudTableSortLabel SortLabel="killsheet_field" T="Document">
                KillSheet
            </MudTableSortLabel>
        </MudTh>
        <MudTh>
            <MudTableSortLabel SortLabel="plant_field" T="Document">
                Plant (Works)
            </MudTableSortLabel>
        </MudTh>
        <MudTh>
            <MudTableSortLabel SortLabel="farm_field" T="Document">
                Farm
            </MudTableSortLabel>
        </MudTh>
        <MudTh>
            <MudTableSortLabel SortLabel="species_field" T="Document">
                Species
            </MudTableSortLabel>
        </MudTh>
        @if (User?.RoleId is (RoleId.ReadWrite or RoleId.Administrator))
        {
            <MudTh Style="text-align: right">
                Actions
            </MudTh>
        }
    </HeaderContent>
    <RowTemplate>
        <MudTd DataLabel="Date">
            @context.DateProcessed.ToString("dd/MM/yyyy")
        </MudTd>
        <MudTd DataLabel="KillSheet">
            @context.KillSheet
        </MudTd>
        <MudTd DataLabel="Plant (Works)">
            @($"{context.Plant.Name} ({context.Plant.Meatwork.Name})")
        </MudTd>
        <MudTd DataLabel="Farm">
            @context.Farm.Name
        </MudTd>
        <MudTd DataLabel="Species">
            @(context.SpeciesType?.DisplayName ?? "Unknown")
        </MudTd>
        @if (User?.RoleId is (RoleId.ReadWrite or RoleId.Administrator))
        {
            <MudTd Class="d-flex justify-end gap-2">
                <MudButton Variant="Variant.Filled" Color="Color.Primary" EndIcon="@Icons.Material.Filled.Email"
                           Href="@($"mailto:{context.Farm.ManagerEmail}?subject=Application%3A%20Warning%20Message&body=Dear%20{context.Farm.ManagerName}%2C%0D%0AYou%20have%20Warning%20Message%0D%0A%0D%0AKind%20Regards%2C%0D%0A{User.Name}")">
                    <MudText Color="Color.Inherit">Email</MudText>
                </MudButton>
                <MudButton Variant="Variant.Filled" Color="Color.Error" EndIcon="@Icons.Material.Filled.Warning"
                           OnClick="OpenDialog">
                    <MudText Color="Color.Inherit">Override</MudText>
                </MudButton>
                @*OnClick="@(() => { _modal.Open("ATS", ActionType.Approve, comment => Approve(context.Document, comment)); })"*@
            </MudTd>
        }
    </RowTemplate>
    <NoRecordsContent>
        <MudText>No matching Animals in Transit found</MudText>
    </NoRecordsContent>
    <LoadingContent>
        <MudText>Loading Animals in Transit...</MudText>
    </LoadingContent>
    <PagerContent>
        <MudTablePager PageSizeOptions="new[] { 20, 40, 80 }"/>
    </PagerContent>
</MudTable>