@page "/invoices/{Id}"
@using AccountsReceivable.API.ViewModels

<Breadcrumb Items="_breadcrumb"/>

@if (_document is not null)
{
    <MudToolBar Dense="true">
        <MudText Typo="Typo.h6">Farm: <b>@_document.Farm.Name</b></MudText>
        <MudSpacer/>
        <MudText Typo="Typo.h6">K/S: <b>@_document.KillSheet</b></MudText>
        <MudSpacer/>
        <MudText Typo="Typo.h6">Date: <b>@_document.DateProcessed.ToString("dd/MM/yyyy")</b></MudText>
        <MudSpacer/>
        <MudText Typo="Typo.h6">Plant: <b>@($"{_document.Plant.Name} ({_document.Plant.Meatwork.Name})")</b></MudText>
        <MudSpacer/>

        <ApproveDeclineButtons
            Role="@User?.RoleId"
            Status="@_document?.StatusId"
            RecalculateTask="@(() => RecalculatePricing())"
            SetApprovedTask="@(() => SetStatusApproved())"
            SetDeclinedTask="@(() => SetStatusDeclined())"
            DetailObjectType="Buyer Created Invoice"/>

    </MudToolBar>

    var rows = new List<Tuple<string, string, string>>
    {
        new("Net Total", _document.NetCostTotal.ToString("C"), _document.CalcNetCostTotal.ToString("C")),
        new("Stock Received", _document.StockCount.ToString(), string.Empty),
        new("Stock Weight (KG)", _document.WeightTotal.ToString("N2"), string.Empty)
    };

    <MudTable Items="rows" Dense="true">
        <HeaderContent>
            <MudTh></MudTh>
            <MudTh>SFF</MudTh>
            <MudTh>Calculated</MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd>
                @context.Item1
            </MudTd>
            <MudTd>
                @context.Item2
            </MudTd>
            <MudTd>
                @context.Item3
            </MudTd>
        </RowTemplate>
    </MudTable>
}

<MudDataGrid
    @ref="_dataGrid"
    T="PriceAnimals"
    ServerData="@(new Func<GridState<PriceAnimals>, Task<GridData<PriceAnimals>>>(GridServerReload))"
    RowStyleFunc="RowStyleFunc"
    Dense="true"
    Hover="true"
    Striped="true">
    <Columns>
        <PropertyColumn Property="x => x.Grade.Name" Title="Grade"/>
        <PropertyColumn Property="@(x => x.Price.MinWeight + "kg")" Title="Min Weight"/>
        <PropertyColumn Property="@(x => x.Price.MaxWeight + "kg")"  Title="Max Weight"/>
        <PropertyColumn Property="x => x.StockCount" Title="Stock Count"/>
        <PropertyColumn Property="@(x => x.StockWeight + "kg")" Title="Stock Weight"/>
        <PropertyColumn Property="x => x.Cost" Title="SFF Price"/>
        <PropertyColumn Property="x => x.CalcCost" Title="Calculated Price"/>
    </Columns>
    <NoRecordsContent>
        <MudText>No matching Created Invoices found</MudText>
    </NoRecordsContent>
    <LoadingContent>
        <MudText>Loading Buyer Created Invoices...</MudText>
    </LoadingContent>
</MudDataGrid>