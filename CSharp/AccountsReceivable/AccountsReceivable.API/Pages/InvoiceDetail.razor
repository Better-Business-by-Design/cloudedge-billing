@page "/invoices/{Id}"

<Breadcrumb Items="_breadcrumb"/>

@if (_document is not null)
{
    <MudToolBar Dense="true">
        <MudText Typo="Typo.h6">Farm: <b>@_document.Farm.Name</b></MudText>
        <MudSpacer/>
        <MudText Typo="Typo.h6">K/S: <b>@_document.KillSheet</b></MudText>
        <MudSpacer/>
        <MudText Typo="Typo.h6">Date: <b>@_document.DateProcessed.ToString("dd/MM/yyyy")</b></MudText>
        <MudSpacer/>
        <MudText Typo="Typo.h6">Plant: <b>@($"{_document.Plant.Name} ({_document.Plant.Meatwork.Name})")</b></MudText>
        <MudSpacer/>

        <ApproveDeclineButtons
            Role="@User?.RoleId"
            Status="@_document?.StatusId"
            SetApprovedTask="new Task(SetDocumentStatusApproved)"
            SetDeclinedTask="new Task(SetDocumentStatusDeclined)"
            DetailObjectType="Buyer Created Invoice"/>

    </MudToolBar>

    var rows = new List<Tuple<string, string, string>>
    {
        new("Net Total", _document.NetCostTotal.ToString("C"), _document.CalcNetCostTotal.ToString("C")),
        new("Stock Received", _document.AnimalTotal.ToString(), string.Empty),
        new("Stock Weight (KG)", _document.AnimalTotal.ToString("N2"), string.Empty)
    };

    <MudTable Items="rows" Dense="true">
        <HeaderContent>
            <MudTh></MudTh>
            <MudTh>SFF</MudTh>
            <MudTh>Calculated</MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd>
                @context.Item1
            </MudTd>
            <MudTd>
                @context.Item2
            </MudTd>
            <MudTd>
                @context.Item3
            </MudTd>
        </RowTemplate>
    </MudTable>
}
<MudTable Dense="true" Hover="true" RowStyleFunc="RowStyleFunc" Class="mt-4"
          ServerData="@(new Func<TableState, Task<TableData<Animal>>>(ServerReload))"
          @ref="_table">
    <HeaderContent>
        @if (_showAnimalId)
        {
            <MudTh>
                <MudTableSortLabel SortLabel="nait_field" T="Animal">
                    NAIT ID
                </MudTableSortLabel>
            </MudTh>
        }
        <MudTh>
            <MudTableSortLabel SortLabel="animal_field" T="Animal">
                SFF Animal Type
            </MudTableSortLabel>
        </MudTh>
        <MudTh>
            <MudTableSortLabel SortLabel="grade_field" T="Animal">
                SFF Grade
            </MudTableSortLabel>
        </MudTh>
        <MudTh>
            <MudTableSortLabel SortLabel="weight_field" T="Animal">
                SFF Weight
            </MudTableSortLabel>
        </MudTh>
        <MudTh>
            <MudTableSortLabel SortLabel="deductions_field" T="Animal">
                Deductions
            </MudTableSortLabel>
        </MudTh>
        <MudTh>
            <MudTableSortLabel SortLabel="total_field" T="Animal">
                SFF Total
            </MudTableSortLabel>
        </MudTh>
        <MudTh>
            <MudTableSortLabel SortLabel="calculated_field" T="Animal">
                Calculated Total
            </MudTableSortLabel>
        </MudTh>
    </HeaderContent>
    <RowTemplate>
        @if (_showAnimalId)
        {
            <MudTd DataLabel="NAIT ID">
                @context.NaitVisual (@context.NaitEid)
            </MudTd>
        }
        <MudTd DataLabel="Animal Type">
            @context.Grade.AnimalType.DisplayName
        </MudTd>
        <MudTd DataLabel="Grade">
            @context.Grade.Name
        </MudTd>
        <MudTd DataLabel="Weight">
            @context.Weight.ToString("0.00")
        </MudTd>
        <MudTd DataLabel="SFF Deductions">
            @context.DeductionCost.ToString("0.00")
        </MudTd>
        <MudTd DataLabel="SFF Total">
            @context.NetCost.ToString("C")
        </MudTd>
        <MudTd DataLabel="Calculated Total">
            @context.CalcNetCost.ToString("C")
        </MudTd>
    </RowTemplate>
    <NoRecordsContent>
        <MudText>No matching Animals found</MudText>
    </NoRecordsContent>
    <LoadingContent>
        <MudText>Loading Animals...</MudText>
    </LoadingContent>
    <PagerContent>
        <MudTablePager PageSizeOptions="new[] { 20, 40, 80 }"/>
    </PagerContent>
</MudTable>