@page "/pricing/{Id}"
@using AccountsReceivable.API.ViewModels

<Breadcrumb Items="_breadcrumb"/>
@if (_schedule is not null)
{
    <MudToolBar Dense="true">

        <MudText Typo="Typo.h6">Works: <b>@_schedule.Meatwork.Name</b></MudText>
        <MudSpacer/>
        <MudText Typo="Typo.h6">Start Date: <b>@_schedule.StartDate.ToString("dd/MM/yyyy")</b></MudText>
        <MudSpacer/>
        <MudText Typo="Typo.h6">End Date: <b>@_schedule.EndDate.ToString("dd/MM/yyyy")</b></MudText>
        <MudSpacer/>
        <MudText Typo="Typo.h6">Status: <b>@_schedule.Status.Name</b></MudText>
        <MudSpacer/>
        <ApproveDeclineButtons
            Role="@User?.RoleId"
            Status="@_schedule?.StatusId"
            SetApprovedTask="@(() => SetStatusApproved())"
            SetDeclinedTask="@(() => SetStatusDeclined())"
            DetailObjectType="Pricing Schedule"/>
    </MudToolBar>
}

<MudDataGrid
    @ref="_dataGrid"
    T="SchedulePriceGroup"
    ServerData="@(new Func<GridState<SchedulePriceGroup>, Task<GridData<SchedulePriceGroup>>>(GridServerReload))"
    SortMode="SortMode.None" FixedHeader="true"
    Dense="true" Bordered="true" Square="true" Height="calc(100vh - 9.6rem)">
    <Columns>
        <PropertyColumn Property="@(x => x.AnimalType.DisplayName)" Title="Animal Type"/>
        <TemplateColumn Title="Grades" T="SchedulePriceGroup">
            <CellTemplate>
                @(string.Join(", ", context.Item.Grades.Select(grade => grade.Name)))
            </CellTemplate>
        </TemplateColumn>
        <PropertyColumn Property="@(x => x.MinWeight + "kg")" Title="Min Weight"/>
        <PropertyColumn Property="@(x => x.MaxWeight + "kg")" Title="Max Weight"/>
        <PropertyColumn Property="@(x => x.Cost)" Title="Price"/>
    </Columns>
    <NoRecordsContent>
        <MudText>No Prices Found</MudText>
    </NoRecordsContent>
    <LoadingContent>
        <MudText>Loading Prices...</MudText>
    </LoadingContent>
</MudDataGrid>